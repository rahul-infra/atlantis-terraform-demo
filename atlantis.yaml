version: 3

workflows:
  atmos:
    plan:
      steps:
        - run: atmos terraform plan my-bucket -s $WORKSPACE
    apply:
      steps:
        - run: atmos terraform apply my-bucket -s $WORKSPACE -- -auto-approve

projects:
  - name: dev-my-bucket
    dir: components/terraform/s3-bucket
    workspace: dev
    workflow: atmos
    autoplan:
      when_modified:
        - "components/terraform/s3-bucket/**/*.tf"
        - "stacks/dev.yaml"
        - "stacks/globals.yaml"
      enabled: true

  - name: staging-my-bucket
    dir: components/terraform/s3-bucket
    workspace: staging
    workflow: atmos
    autoplan:
      when_modified:
        - "components/terraform/s3-bucket/**/*.tf"
        - "stacks/staging.yaml"
        - "stacks/globals.yaml"
      enabled: true
