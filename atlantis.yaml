version: 3
automerge: false
delete_source_branch_on_merge: false

# Define projects for each Atmos component/stack combination
projects:
  # S3 Bucket - Dev Environment
  - name: s3-bucket-dev
    dir: components/terraform/s3-bucket
    workspace: dev
    terraform_version: v1.0.0
    autoplan:
      when_modified:
        - "components/terraform/s3-bucket/**/*.tf"
        - "stacks/dev.yaml"
        - "stacks/globals.yaml"
      enabled: true
    apply_requirements:
      - approved

  # S3 Bucket - Staging Environment
  - name: s3-bucket-staging
    dir: components/terraform/s3-bucket
    workspace: staging
    terraform_version: v1.0.0
    autoplan:
      when_modified:
        - "components/terraform/s3-bucket/**/*.tf"
        - "stacks/staging.yaml"
        - "stacks/globals.yaml"
      enabled: true
    apply_requirements:
      - approved
